# 16. 结构化概率模型

## 16.1 非结构化建模的挑战

### 概率模型

#### 分类任务

#### 回归任务(?)

- 估计密度函数
  - 给定一个输入 x，机器学习系统返回一个对数据生成分布的真实密度函数 p(x) 的估计。
- 去噪
  - 给定一个受损的或者观察有误的输入数据 x˜，机器学习系统返回一个对原始的真实 x 的估计。
- 缺失值的填补
  - 给定 x 的某些元素作为观察值，模型被要求返回**部分或全部未观察值**的估计/概率分布。
- 采样
  - 模型从分布 p(x) 中抽取新的样本。

### 概率模型的问题(面对大规模随机变量)

#### 内存开销

- 假设x的分布为：n个离散变量，每个变量可取k个值。则可用含有$k^n$项的表格(或Python中的多维数组/字典)表示 P(x)。

示例代码：

```python
import itertools
import random
import time
import psutil
import os

n = 25 # 变量的个数
k = 2  # 每个变量可以取的值数

# 记录开始时间和初始内存
start_time = time.time(
process = psutil.Process(os.getpid())
start_memory = process.memory_info().rss / (1024 * 1024)  # 转换为MB

# 初始化表格，使用字典存储联合分布
P = {}

# 生成所有可能的组合并赋予随机概率
for combo in itertools.product(range(k), repeat=n):
    P[combo] = random.random()  # 为每个组合赋予随机概率

# 记录结束时间和最终内存
end_time = time.time()
end_memory = process.memory_info().rss / (1024 * 1024)  # 转换为MB

# 计算时间和内存开销
execution_time = end_time - start_time
memory_usage = end_memory - start_memory

# 输出时间和内存开销
print(f"建立表格的时间开销: {execution_time:.6f} 秒")
print(f"建立表格的内存开销: {memory_usage:.6f} MB")

# 示例：输出部分联合分布
print("\n部分联合分布:")
for i, (key, value) in enumerate(P.items()):
    print(f"P{key} = {value:.6f}")
    if i >= 5:  # 仅输出前 6 项
        break

# 输出：
# 建立表格的时间开销: 30.141879 秒
# 建立表格的内存开销: 9505.300781 MB(约9G)
```

#### 统计开销

#### 推理开销

#### 采样开销

0P506

## 16.2 使用图描述模型结构

### 图论

在学习**结构化概率模型**之前，了解**图论**的相关知识非常重要，因为很多概率模型（如**贝叶斯网络**和**马尔可夫随机场**）都可以用图来表示。图论是研究图这种数学结构的学科，图论中的概念为我们描述和分析复杂的概率关系提供了有力工具。

#### 基本概念

1. **图（Graph）**：由**节点**（vertices）和**边**（edges）组成，表示对象及其关系。
   - **有向图**：边有方向，表示单向关系。
   - **无向图**：边无方向，表示双向关系。

2. **节点（Node/Vertex）**：图中的基本元素，代表个体或变量。

3. **边（Edge）**：连接节点的线，表示节点间的关系。

4. **邻居（Neighbors）**：通过边相连的节点，表示两个变量直接相关。

5. **路径（Path）**：从一个节点到另一个节点的连接方式。

6. **环（Cycle）**：路径起点和终点是同一个节点。

#### 图的类型

1. **有向无环图（Directed Acyclic Graph, DAG）**：
   - **DAG** 是一种没有环的有向图。在概率模型中，DAG 通常用于构建**贝叶斯网络**。每个节点表示一个随机变量，有向边表示因果关系或条件依赖关系。
   - **无环性**意味着从一个节点出发，无法通过有向边返回该节点。

2. **无向图（Undirected Graph）**：
   - 无向图的边没有方向，常用于**马尔可夫随机场（Markov Random Field, MRF）**等模型。边表示两个节点之间的对称依赖关系。

#### 图的相关概念在结构化概率模型中的应用

1. **贝叶斯网络（Bayesian Network）**：
   - 是一种使用有向无环图（DAG）表示的结构化概率模型。每个节点表示一个随机变量，每条有向边表示条件依赖关系。贝叶斯网络通过结构化的方式刻画了变量之间的条件独立性。

2. **马尔可夫随机场（Markov Random Field, MRF）**：
   - 是一种使用无向图表示的结构化概率模型。每个节点表示随机变量，边表示变量之间的相互依赖。无向图表示变量之间的联合概率分布和无条件的依赖关系。

### 有向图模型(Directed Graphocal Model)
